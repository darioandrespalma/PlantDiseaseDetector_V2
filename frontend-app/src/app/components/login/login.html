<!-- Fondo con partÃ­culas -->
<div class="background">
  <div class="particles" aria-hidden="true"></div>
</div>

<!-- Logo con animaciÃ³n lunar -->
<div class="app-header" [@logoAnimation]="logoState">
  <div class="logo-container">
    <svg class="logo-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <path d="M50 10 C30 10, 10 30, 10 50 C10 70, 30 90, 50 90 C70 90, 90 70, 90 50 C90 30, 70 10, 50 10 M50 5 C50 5, 50 5, 50 5" 
            fill="none" stroke="currentColor" stroke-width="2"/>
      <circle cx="50" cy="50" r="35" fill="currentColor" opacity="0.2"/>
      <path d="M50 15 C50 15, 50 15, 50 15" fill="currentColor"/>
    </svg>
  </div>
  <h1 class="app-title">Plant Disease Detector</h1>
  <span class="version-badge">v2.0</span>
  <p class="app-subtitle">Asistencia AgrÃ­cola Inteligente</p>
</div>

<!-- Contenedor principal con animaciones -->
<main class="login-container" [@formAnimations]>
  <mat-card class="login-card">
    <!-- Toggle tema -->
    <button 
      class="theme-toggle" 
      mat-icon-button 
      (click)="toggleDark()" 
      aria-label="Cambiar tema"
      [class.dark]="theme.isDark()">
      <mat-icon class="theme-icon">
        <span class="sun-icon">â˜€ï¸</span>
        <span class="moon-icon">ğŸŒ™</span>
      </mat-icon>
    </button>

    <!-- Header -->
    <mat-card-header class="card-header">
      <mat-card-title class="card-title">Iniciar SesiÃ³n</mat-card-title>
      <mat-card-subtitle class="card-subtitle">
        Accede a tu asistente lunar
      </mat-card-subtitle>
    </mat-card-header>

    <!-- Formulario -->
    <mat-card-content class="card-content">
      <form [formGroup]="form" (ngSubmit)="submit()">
        <!-- Email -->
        <mat-form-field 
          class="anim-item custom-field" 
          appearance="fill"
          [@shake]="form.errors?.['invalid'] ? 'error' : 'void'"> <!-- âœ… CORREGIDO -->
          <mat-label class="field-label">Correo electrÃ³nico</mat-label>
          <input 
            matInput 
            type="email" 
            formControlName="email"
            class="field-input"
            placeholder="tu@email.com">
          <mat-icon matPrefix class="field-icon">alternate_email</mat-icon>
          <mat-error *ngIf="email?.errors?.['required']"> <!-- âœ… CORREGIDO -->
            <mat-icon>error</mat-icon>
            El correo es obligatorio
          </mat-error>
          <mat-error *ngIf="email?.errors?.['email']"> <!-- âœ… CORREGIDO -->
            <mat-icon>warning</mat-icon>
            Formato invÃ¡lido
          </mat-error>
        </mat-form-field>

        <!-- Password -->
        <mat-form-field 
          class="anim-item custom-field" 
          appearance="fill"
          [@shake]="form.errors?.['invalid'] ? 'error' : 'void'"> <!-- âœ… CORREGIDO -->
          <mat-label class="field-label">ContraseÃ±a</mat-label>
          <input 
            matInput 
            [type]="hide ? 'password' : 'text'" 
            formControlName="password"
            class="field-input"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
          <mat-icon matPrefix class="field-icon">lock</mat-icon>
          <button 
            mat-icon-button 
            matSuffix 
            type="button" 
            (click)="hide = !hide"
            class="toggle-password">
            <mat-icon>{{ hide ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="password?.errors?.['required']"> <!-- âœ… CORREGIDO -->
            <mat-icon>error</mat-icon>
            La contraseÃ±a es obligatoria
          </mat-error>
          <mat-error *ngIf="password?.errors?.['minlength']"> <!-- âœ… CORREGIDO -->
            <mat-icon>warning</mat-icon>
            MÃ­nimo 6 caracteres
          </mat-error>
        </mat-form-field>

        <!-- BotÃ³n de Login -->
        <button 
          class="anim-item login-btn"
          mat-raised-button 
          color="primary" 
          type="submit"
          [disabled]="form.invalid || isLoading">
          <span class="btn-content">
            <ng-container *ngIf="!isLoading; else loading">
              <mat-icon class="btn-icon">login</mat-icon>
              <span>Entrar al Sistema</span>
            </ng-container>
            <ng-template #loading>
              <div class="btn-loader">
                <mat-progress-spinner 
                  diameter="24" 
                  strokeWidth="3" 
                  mode="indeterminate">
                </mat-progress-spinner>
                <span>Iniciando sesiÃ³n...</span>
              </div>
            </ng-template>
          </span>
        </button>

        <!-- Links -->
        <div class="card-links anim-item">
          <a routerLink="/forgot-password" class="link-item">
            <mat-icon class="link-icon">help</mat-icon>
            Â¿Olvidaste tu contraseÃ±a?
          </a>
          <span class="link-separator">â€¢</span>
          <a routerLink="/register" class="link-item">
            <mat-icon class="link-icon">person_add</mat-icon>
            Registrarse
          </a>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</main>

<!-- Footer lunar -->
<footer class="lunar-footer">
  <div class="moon-phase">
    <span class="phase-icon">ğŸŒ•</span>
    <span class="phase-text">Luna Llena - Ideal para cosechar</span>
  </div>
</footer>