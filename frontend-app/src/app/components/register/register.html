<!-- src/app/components/register/register.html -->
<div class="background"></div>

<div class="container" [@fadeIn]>
  <mat-card class="register-card">
    <div class="top-actions">
      <button mat-icon-button (click)="toggleDark()" aria-label="Cambiar tema">
        <mat-icon>{{ dark ? 'dark_mode' : 'light_mode' }}</mat-icon>
      </button>
    </div>

    <mat-card-header>
      <mat-card-title>Crear cuenta</mat-card-title>
      <mat-card-subtitle>Plant Disease Detector v2</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>
        <!-- Nombre -->
        <mat-form-field appearance="outline">
          <mat-label>Nombre de usuario</mat-label>
          <input matInput formControlName="username" type="text" />
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="f['username'].touched && f['username'].hasError('required')">
            El nombre es requerido
          </mat-error>
          <mat-error *ngIf="f['username'].touched && f['username'].hasError('minlength')">
            Mínimo 3 caracteres
          </mat-error>
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="outline">
          <mat-label>Correo electrónico</mat-label>
          <input matInput formControlName="email" type="email" placeholder="tu@correo.com" />
          <mat-icon matSuffix>alternate_email</mat-icon>
          <mat-error *ngIf="f['email'].touched && f['email'].hasError('required')">
            El correo es requerido
          </mat-error>
          <mat-error *ngIf="f['email'].touched && f['email'].hasError('email')">
            Formato de correo inválido
          </mat-error>
        </mat-form-field>

        <!-- Password -->
        <mat-form-field appearance="outline">
          <mat-label>Contraseña</mat-label>
          <input matInput [type]="hidePwd ? 'password' : 'text'" formControlName="password" />
          <button mat-icon-button matSuffix type="button" (click)="hidePwd = !hidePwd" [attr.aria-label]="hidePwd ? 'Mostrar contraseña' : 'Ocultar contraseña'">
            <mat-icon>{{ hidePwd ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="f['password'].touched && f['password'].hasError('required')">
            La contraseña es requerida
          </mat-error>
          <mat-error *ngIf="f['password'].touched && f['password'].hasError('minlength')">
            Debe tener al menos 6 caracteres
          </mat-error>
        </mat-form-field>

        <!-- Medidor de fuerza -->
        <div class="strength">
          <mat-progress-bar mode="determinate" [value]="strength"></mat-progress-bar>
          <span class="label" [class.good]="strength>=60" [class.strong]="strength>=85">
            {{ strength < 30 ? 'Débil' : strength < 60 ? 'Media' : strength < 85 ? 'Buena' : 'Fuerte' }}
          </span>
        </div>

        <!-- Confirmar contraseña -->
        <mat-form-field appearance="outline">
          <mat-label>Confirmar contraseña</mat-label>
          <input matInput [type]="hidePwd2 ? 'password' : 'text'" formControlName="confirmPassword" />
          <button mat-icon-button matSuffix type="button" (click)="hidePwd2 = !hidePwd2" [attr.aria-label]="hidePwd2 ? 'Mostrar contraseña' : 'Ocultar contraseña'">
            <mat-icon>{{ hidePwd2 ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="f['confirmPassword'].touched && f['confirmPassword'].hasError('required')">
            Confirma tu contraseña
          </mat-error>
          <mat-error *ngIf="formErrors.passwordsNotMatch && registerForm.touched">
            Las contraseñas no coinciden
          </mat-error>
        </mat-form-field>

        <!-- Términos -->
        <mat-checkbox formControlName="acceptTerms">
          Acepto los términos y la política de privacidad
        </mat-checkbox>
        <div class="hint">Usaremos tu correo solo para autenticación y notificaciones del sistema.</div>

        <!-- Botón -->
        <button mat-raised-button color="primary" type="submit" class="submit-btn"
                [disabled]="registerForm.invalid || isLoading">
          <ng-container *ngIf="!isLoading; else loadingTpl">
            Registrarse
          </ng-container>
          <ng-template #loadingTpl>
            <mat-progress-spinner mode="indeterminate" diameter="18" strokeWidth="3"></mat-progress-spinner>
            <span class="loading-text">Creando…</span>
          </ng-template>
        </button>

        <!-- Link a login -->
        <div class="switch">
          <span>¿Ya tienes cuenta?</span>
          <a routerLink="/login">Inicia sesión</a>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
